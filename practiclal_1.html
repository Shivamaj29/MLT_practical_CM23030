<!DOCTYPE html>
<html>
<head>
  <title>Temperature vs Electricity Usage</title>

  <!-- TensorFlow JS -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>

  <!-- TensorFlow Visualization -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-vis"></script>

  <style>
    body {
      font-family: Arial;
      background-color: #eef1f4;
      padding: 20px;
    }

    .card {
      background: white;
      padding: 20px;
      width: 500px;
      border-radius: 10px;
      box-shadow: 0px 0px 10px rgba(0,0,0,0.1);
    }

    button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 8px 14px;
      cursor: pointer;
      border-radius: 5px;
    }

    input {
      padding: 6px;
      width: 100px;
    }
  </style>
</head>

<body>

<h2>üå°Ô∏è Temperature vs Electricity Usage Prediction</h2>

<div class="card">

<p><b>Training Dataset</b></p>
<p>20¬∞C ‚Üí 5 Units</p>
<p>25¬∞C ‚Üí 8 Units</p>
<p>30¬∞C ‚Üí 12 Units</p>
<p>35¬∞C ‚Üí 16 Units</p>
<p>40¬∞C ‚Üí 20 Units</p>

<button onclick="trainModel()">Train Model</button>

<br><br>

<label>Enter Temperature (¬∞C):</label>
<input type="number" id="temp" value="32">

<button onclick="predictUsage()">Predict</button>

<p id="status"></p>
<p id="result"></p>

</div>

<br>

<div id="charts"></div>

<script>

let model;
let isModelTrained = false;

// ---------------- TRAIN MODEL ----------------

async function trainModel() {

  document.getElementById("status").innerHTML = "Training Started...";

  // Original Data
  const tempData = [20, 25, 30, 35, 40];
  const usageData = [5, 8, 12, 16, 20];

  // Normalize Data (IMPORTANT)
  const tempTensor = tf.tensor2d(tempData, [5,1]).div(40);
  const usageTensor = tf.tensor2d(usageData, [5,1]).div(20);

  // Scatter Plot
  const points = tempData.map((val, i) => ({
    x: val,
    y: usageData[i]
  }));

  tfvis.render.scatterplot(
    { name: "Temperature vs Electricity Usage" },
    { values: points },
    { xLabel: "Temperature (¬∞C)", yLabel: "Units", height: 300 }
  );

  // Create Model
  model = tf.sequential();

  model.add(tf.layers.dense({
    units: 1,
    inputShape: [1]
  }));

  model.compile({
    optimizer: tf.train.sgd(0.1),
    loss: "meanSquaredError"
  });

  // Train Model
  await model.fit(tempTensor, usageTensor, {
    epochs: 300,
    callbacks: tfvis.show.fitCallbacks(
      { name: "Training Loss" },
      ["loss"]
    )
  });

  isModelTrained = true;

  document.getElementById("status").innerHTML =
    "Training Completed Successfully ‚úÖ";

  console.log("MODEL TRAINED SUCCESSFULLY");
}


// ---------------- PREDICTION ----------------

function predictUsage() {

  if (!isModelTrained) {
    alert("Please train the model first!");
    return;
  }

  let inputTemp =
    parseFloat(document.getElementById("temp").value);

  // Validation
  if (isNaN(inputTemp)) {
    alert("Please enter valid temperature value");
    return;
  }

  // Normalize Input
  const inputTensor =
    tf.tensor2d([inputTemp / 40], [1,1]);

  // Predict
  const prediction = model.predict(inputTensor);

  const outputValue =
    prediction.dataSync()[0] * 20;

  // UI Output
  document.getElementById("result").innerHTML =
    "‚ö° Predicted Electricity Usage: <b>" +
    outputValue.toFixed(2) + " Units</b>";

  // Console Output
  console.log("==============================");
  console.log("Input Temperature:", inputTemp);
  console.log("Predicted Units:", outputValue);
  console.log("==============================");
}

</script>
